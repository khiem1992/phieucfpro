<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHIẾU THU INTERNET</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Tùy chỉnh làm nổi bật hạn dùng gần nhất */
        #prevDueDate {
            font-weight: 800; /* Extra bold */
            font-size: 1.5rem; /* Lớn hơn */
            color: #dc3545; /* Màu đỏ nổi bật */
            animation: pulse-red 1.5s infinite;
        }

        @keyframes pulse-red {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        /* Đảm bảo khối nội dung nằm giữa và có padding */
        .main-container {
            max-width: 550px;
        }

        /* Tùy chỉnh cho ô nhập số tiền nộp */
        #paidAmount {
            background-color: #fff3cd; /* Màu vàng nhạt nổi bật */
            border-color: #ffc107;
            font-size: 1.5rem;
            font-weight: 900;
        }
    </style>
</head>
<body class="bg-light min-vh-100 p-3 p-sm-5">
    <div class="main-container mx-auto">
        <h1 class="text-center text-dark mb-4 fw-bold">PHIẾU THU INTERNET</h1>

        <div class="card shadow-lg mb-4 border-0 rounded-4">
            <div class="card-body">
                <h2 class="card-title fs-5 mb-3 text-secondary">1. Khách Hàng</h2>
                <div class="input-group">
                    <select id="customerSelect" onchange="loadCustomerDetail()" class="form-select" aria-label="Chọn Khách Hàng">
                        <option value="">-- Chọn Khách Hàng --</option>
                    </select>
                    <button onclick="openNewCustomerModal()" class="btn btn-success" type="button" title="Thêm Khách Hàng Mới">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg" viewBox="0 0 16 16">
                          <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"/>
                        </svg>
                    </button>
                </div>
                <p id="currentFeeDisplay" class="text-primary mt-2 fw-medium"></p>
            </div>
        </div>

        <div class="card shadow-lg mb-4 border-0 rounded-4">
            <div class="card-body">
                <h2 class="card-title fs-5 mb-3 text-secondary">2. Cập Nhật Thanh Toán</h2>
                
                <div class="mb-3">
                    <label for="paidAmount" class="form-label fw-medium text-dark">Số tiền nộp (VND) (*)</label>
                    <input type="text" id="paidAmount" oninput="formatAndCalculate()" placeholder="Ví dụ: 700.000" class="form-control text-center">
                </div>
                
                <div class="row g-3">
                    <div class="col-12">
                        <div class="p-3 bg-success-subtle border border-success-subtle rounded-3 d-flex justify-content-between align-items-center">
                            <span class="fw-medium text-success-emphasis">Hạn dùng mới (Dự kiến)</span>
                            <div class="text-end">
                                <span id="newDueDateDisplay" class="fs-5 fw-bold text-success-emphasis">...</span>
                                <span id="monthsDisplay" class="ms-2 badge text-bg-success"></span>
                            </div>
                        </div>
                    </div>

                    <div class="col-12">
                        <label for="newNote" class="form-label fw-medium text-dark">Ghi chú (Mới)</label>
                        <textarea id="newNote" rows="2" placeholder="Thông tin liên hệ, địa chỉ mới, v.v." class="form-control"></textarea>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-lg mb-4 border-0 rounded-4">
            <div class="card-body">
                <h2 class="card-title fs-5 mb-3 text-secondary">3. Lịch Sử Gần Nhất</h2>
                <div id="historyInfo" class="small">
                    <p class="mb-2"><strong>Hạn dùng gần nhất:</strong> <span id="prevDueDate">...</span></p>
                    <p class="mb-2"><strong>Ngày nộp (lần trước):</strong> <span id="prevPaidDate">...</span></p>
                    <p class="mb-2"><strong>Số tiền nộp trước:</strong> <span id="prevAmountHistory">...</span></p>
                    <p class="mb-0"><strong>Ghi chú cũ:</strong> <span id="oldNote">...</span></p>
                </div>
            </div>
        </div>

        <button onclick="confirmPayment()" id="confirmButton" class="btn btn-primary btn-lg w-100 fw-bold rounded-3 shadow-sm mb-3">Xác Nhận Nộp Tiền</button>
        <div id="message" class="text-center fw-medium mt-3"></div>
    </div>

    <div class="modal fade" id="newCustomerModal" tabindex="-1" aria-labelledby="newCustomerModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content rounded-4 shadow-lg">
                <div class="modal-header">
                    <h5 class="modal-title fw-bold text-dark" id="newCustomerModalLabel">Thêm Khách Hàng Mới</h5>
                    <button type="button" class="btn-close" onclick="closeNewCustomerModal()" aria-label="Close"></button>
                </div>
                <form id="newCustomerForm" onsubmit="event.preventDefault(); addNewCustomer();">
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="modalTenKH" class="form-label">Tên Khách Hàng (*)</label>
                            <input type="text" id="modalTenKH" required class="form-control" placeholder="Tên Khách Hàng">
                        </div>
                        <div class="mb-3">
                            <label for="modalGoiCuoc" class="form-label">Gói Cước (VND/tháng) (*)</label>
                            <input type="number" id="modalGoiCuoc" required min="1" class="form-control" placeholder="Ví dụ: 70000">
                        </div>
                        <div class="mb-3">
                            <label for="modalTienNop" class="form-label">Tiền Nộp Ban Đầu (*)</label>
                            <input type="text" id="modalTienNop" oninput="formatModalMoney(this)" required class="form-control" placeholder="Ví dụ: 800.000">
                        </div>
                        <div class="mb-3">
                            <label for="modalHanDung" class="form-label">Hạn Dùng (dd/mm/yyyy) (*)</label>
                            <input type="text" id="modalHanDung" required class="form-control" placeholder="Ví dụ: 31/12/2025">
                            <small class="form-text text-muted">Chỉ cần nhập ngày, Apps Script sẽ tự động điều chỉnh nếu cần.</small>
                        </div>
                        <div class="mb-3">
                            <label for="modalGhiChu" class="form-label">Ghi Chú</label>
                            <textarea id="modalGhiChu" rows="2" class="form-control" placeholder="Địa chỉ, số điện thoại, v.v."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer d-block">
                        <div id="modalMessage" class="text-center fw-medium mb-3"></div>
                        <button type="submit" id="modalConfirmButton" class="btn btn-success w-100 fw-bold">Thêm Khách Hàng</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="script.js"></script>
</body>
</html>
